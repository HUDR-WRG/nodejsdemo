<wxs module="m1">
var getColor = function(score) {
  if (score <= 3) return '#F76D57';
  if (score <= 6) return '#6EB5FF';
  return '#67C23A';
}

var getMoodText = function(score) {
  if (score <= 3) return 'éœ€è¦å…³æ€€';
  if (score <= 6) return 'å¹³é™èˆ’ç¼“';
  return 'ç§¯æå‘ä¸Š';
}

module.exports = {
  getColor: getColor,
  getMoodText: getMoodText
};
</wxs>

<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-back" bindtap="goBack">
      <view class="back-icon">â€¹</view>
    </view>
    <view class="nav-title">å¿ƒæƒ…è®°å½•</view>
    <view class="nav-action" bindtap="shareDiary">
      <view class="action-icon">â‹¯</view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view scroll-y class="content-scroll" wx:if="{{!isLoading && diary}}">
    <!-- æ—¥æœŸå¡ç‰‡ -->
    <view class="date-card">
      <view class="date-text">{{diary.formatted_date}}</view>
      <view class="weekday">{{diary.weekday || ''}}</view>
    </view>

    <!-- å¿ƒæƒ…å¡ç‰‡ -->
    <view class="mood-card">
      <view class="mood-header">
        <view class="mood-icon" style="background-color: {{m1.getColor(diary.mood_score)}}">
          <text class="mood-emoji">{{diary.mood_score <= 3 ? 'ğŸ˜' : diary.mood_score <= 6 ? 'ğŸ˜Œ' : 'ğŸ˜Š'}}</text>
        </view>
        <view class="mood-info">
          <view class="mood-score">{{diary.mood_score}}/10</view>
          <view class="mood-label">{{m1.getMoodText(diary.mood_score)}}</view>
        </view>
      </view>
      <view class="mood-bar">
        <view class="mood-progress" style="width: {{diary.mood_score * 10}}%; background-color: {{m1.getColor(diary.mood_score)}}"></view>
      </view>
    </view>

    <!-- å†…å®¹å¡ç‰‡ -->
    <view class="content-card">
      <view class="content-header">
        <view class="content-title">ä»Šæ—¥å¿ƒå¾—</view>
      </view>
      <view class="content-text">{{diary.content}}</view>
    </view>

    <!-- æ ‡ç­¾å¡ç‰‡ -->
    <view class="tags-card" wx:if="{{diary.tags && diary.tags.length > 0}}">
      <view class="tags-header">
        <view class="tags-title">æƒ…ç»ªæ ‡ç­¾</view>
      </view>
      <view class="tags-list">
        <view class="tag-item" wx:for="{{diary.tags}}" wx:key="*this">
          <text class="tag-text">{{item}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ“ä½œåŒºåŸŸ -->
    <view class="action-area">
      <button class="edit-btn" bindtap="editDiary">
        <text class="btn-icon">âœï¸</text>
        <text class="btn-text">ç¼–è¾‘</text>
      </button>
      <button class="delete-btn" bindtap="deleteDiary">
        <text class="btn-icon">ğŸ—‘ï¸</text>
        <text class="btn-text">åˆ é™¤</text>
      </button>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-wrapper" wx:if="{{isLoading}}">
    <view class="loading-card">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-wrapper" wx:if="{{!isLoading && !diary}}">
    <view class="error-card">
      <view class="error-icon">ğŸ˜”</view>
      <text class="error-title">åŠ è½½å¤±è´¥</text>
      <text class="error-desc">æ— æ³•è·å–æ—¥è®°å†…å®¹</text>
      <button class="retry-btn" bindtap="goBack">è¿”å›ä¸Šé¡µ</button>
    </view>
  </view>
</view> 